{"ast":null,"code":"/**\n * API Service - Base Axios Configuration\n * Following frontend-developer and react-best-practices patterns\n * Handles Keycloak token injection, error handling, and request/response transformations\n */\n\nimport axios from 'axios';\nimport keycloak from '../keycloak';\n\n// Create axios instance with base configuration\nconst api = axios.create({\n  baseURL: process.env.REACT_APP_API_URL || 'http://localhost:5000',\n  timeout: 30000,\n  // 30 seconds\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Request interceptor - Attach Keycloak token\napi.interceptors.request.use(config => {\n  // Skip auth for health checks\n  if (config.url === '/health') {\n    return config;\n  }\n\n  // Always inject Keycloak token - no dev mode bypass\n  if (keycloak.token) {\n    config.headers.Authorization = `Bearer ${keycloak.token}`;\n    console.log('ðŸ” [API] Injecting Bearer token:', keycloak.token.substring(0, 20) + '...');\n  } else {\n    console.warn('âš ï¸ [API] No Keycloak token available - request may fail');\n  }\n  return config;\n}, error => {\n  console.error('[API] Request error:', error);\n  return Promise.reject(error);\n});\n\n// Response interceptor - Handle errors globally\napi.interceptors.response.use(response => {\n  // Successful response - return data directly\n  return response;\n}, async error => {\n  var _error$response, _error$response2, _error$response2$data, _error$response3, _error$response4;\n  const originalRequest = error.config;\n\n  // Handle 401 Unauthorized - Token expired\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    try {\n      // Attempt to refresh Keycloak token\n      if (keycloak.updateToken) {\n        const refreshed = await keycloak.updateToken(30); // Refresh if expiring in 30s\n\n        if (refreshed) {\n          console.log('âœ… [API] Token refreshed');\n          // Retry original request with new token\n          originalRequest.headers.Authorization = `Bearer ${keycloak.token}`;\n          return api(originalRequest);\n        }\n      }\n    } catch (refreshError) {\n      console.error('[API] Token refresh failed:', refreshError);\n      // Redirect to login if refresh fails\n      if (keycloak.login) {\n        keycloak.login();\n      }\n      return Promise.reject(refreshError);\n    }\n  }\n\n  // Handle specific error statuses\n  const errorMessage = ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || error.message;\n  const errorStatus = (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status;\n  console.error(`[API] Error ${errorStatus}:`, errorMessage);\n\n  // Format error for consistent handling\n  const formattedError = {\n    status: errorStatus,\n    message: errorMessage,\n    data: (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.data,\n    originalError: error\n  };\n  return Promise.reject(formattedError);\n});\n\n/**\n * Helper function to handle file downloads\n */\nexport const downloadFile = async (url, filename) => {\n  try {\n    const response = await api.get(url, {\n      responseType: 'blob' // Important for file downloads\n    });\n\n    // Create blob link to download\n    const blob = new Blob([response.data]);\n    const link = document.createElement('a');\n    link.href = window.URL.createObjectURL(blob);\n    link.download = filename || 'download';\n    link.click();\n\n    // Cleanup\n    window.URL.revokeObjectURL(link.href);\n    return {\n      success: true\n    };\n  } catch (error) {\n    console.error('[API] Download error:', error);\n    throw error;\n  }\n};\n\n/**\n * Helper function to upload files with multipart/form-data\n */\nexport const uploadFile = async (url, file, onUploadProgress) => {\n  const formData = new FormData();\n  formData.append('file', file);\n  try {\n    const response = await api.post(url, formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      },\n      onUploadProgress: progressEvent => {\n        if (onUploadProgress) {\n          const percentCompleted = Math.round(progressEvent.loaded * 100 / progressEvent.total);\n          onUploadProgress(percentCompleted);\n        }\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error('[API] Upload error:', error);\n    throw error;\n  }\n};\nexport default api;","map":{"version":3,"names":["axios","keycloak","api","create","baseURL","process","env","REACT_APP_API_URL","timeout","headers","interceptors","request","use","config","url","token","Authorization","console","log","substring","warn","error","Promise","reject","response","_error$response","_error$response2","_error$response2$data","_error$response3","_error$response4","originalRequest","status","_retry","updateToken","refreshed","refreshError","login","errorMessage","data","message","errorStatus","formattedError","originalError","downloadFile","filename","get","responseType","blob","Blob","link","document","createElement","href","window","URL","createObjectURL","download","click","revokeObjectURL","success","uploadFile","file","onUploadProgress","formData","FormData","append","post","progressEvent","percentCompleted","Math","round","loaded","total"],"sources":["/Users/mrnugroho/Downloads/pemda-dashboard-react/frontend/src/services/api.js"],"sourcesContent":["/**\n * API Service - Base Axios Configuration\n * Following frontend-developer and react-best-practices patterns\n * Handles Keycloak token injection, error handling, and request/response transformations\n */\n\nimport axios from 'axios';\nimport keycloak from '../keycloak';\n\n// Create axios instance with base configuration\nconst api = axios.create({\n    baseURL: process.env.REACT_APP_API_URL || 'http://localhost:5000',\n    timeout: 30000, // 30 seconds\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\n// Request interceptor - Attach Keycloak token\napi.interceptors.request.use(\n    (config) => {\n        // Skip auth for health checks\n        if (config.url === '/health') {\n            return config;\n        }\n\n        // Always inject Keycloak token - no dev mode bypass\n        if (keycloak.token) {\n            config.headers.Authorization = `Bearer ${keycloak.token}`;\n            console.log('ðŸ” [API] Injecting Bearer token:', keycloak.token.substring(0, 20) + '...');\n        } else {\n            console.warn('âš ï¸ [API] No Keycloak token available - request may fail');\n        }\n\n        return config;\n    },\n    (error) => {\n        console.error('[API] Request error:', error);\n        return Promise.reject(error);\n    }\n);\n\n// Response interceptor - Handle errors globally\napi.interceptors.response.use(\n    (response) => {\n        // Successful response - return data directly\n        return response;\n    },\n    async (error) => {\n        const originalRequest = error.config;\n\n        // Handle 401 Unauthorized - Token expired\n        if (error.response?.status === 401 && !originalRequest._retry) {\n            originalRequest._retry = true;\n\n            try {\n                // Attempt to refresh Keycloak token\n                if (keycloak.updateToken) {\n                    const refreshed = await keycloak.updateToken(30); // Refresh if expiring in 30s\n\n                    if (refreshed) {\n                        console.log('âœ… [API] Token refreshed');\n                        // Retry original request with new token\n                        originalRequest.headers.Authorization = `Bearer ${keycloak.token}`;\n                        return api(originalRequest);\n                    }\n                }\n            } catch (refreshError) {\n                console.error('[API] Token refresh failed:', refreshError);\n                // Redirect to login if refresh fails\n                if (keycloak.login) {\n                    keycloak.login();\n                }\n                return Promise.reject(refreshError);\n            }\n        }\n\n        // Handle specific error statuses\n        const errorMessage = error.response?.data?.message || error.message;\n        const errorStatus = error.response?.status;\n\n        console.error(`[API] Error ${errorStatus}:`, errorMessage);\n\n        // Format error for consistent handling\n        const formattedError = {\n            status: errorStatus,\n            message: errorMessage,\n            data: error.response?.data,\n            originalError: error,\n        };\n\n        return Promise.reject(formattedError);\n    }\n);\n\n/**\n * Helper function to handle file downloads\n */\nexport const downloadFile = async (url, filename) => {\n    try {\n        const response = await api.get(url, {\n            responseType: 'blob', // Important for file downloads\n        });\n\n        // Create blob link to download\n        const blob = new Blob([response.data]);\n        const link = document.createElement('a');\n        link.href = window.URL.createObjectURL(blob);\n        link.download = filename || 'download';\n        link.click();\n\n        // Cleanup\n        window.URL.revokeObjectURL(link.href);\n\n        return { success: true };\n    } catch (error) {\n        console.error('[API] Download error:', error);\n        throw error;\n    }\n};\n\n/**\n * Helper function to upload files with multipart/form-data\n */\nexport const uploadFile = async (url, file, onUploadProgress) => {\n    const formData = new FormData();\n    formData.append('file', file);\n\n    try {\n        const response = await api.post(url, formData, {\n            headers: {\n                'Content-Type': 'multipart/form-data',\n            },\n            onUploadProgress: (progressEvent) => {\n                if (onUploadProgress) {\n                    const percentCompleted = Math.round(\n                        (progressEvent.loaded * 100) / progressEvent.total\n                    );\n                    onUploadProgress(percentCompleted);\n                }\n            },\n        });\n\n        return response.data;\n    } catch (error) {\n        console.error('[API] Upload error:', error);\n        throw error;\n    }\n};\n\nexport default api;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}