{"ast":null,"code":"/**\n * API Service - Base Axios Configuration\n * Following frontend-developer and react-best-practices patterns\n * Handles Keycloak token injection, error handling, and request/response transformations\n */\n\nimport axios from 'axios';\n\n// Create axios instance with base configuration\n// Create axios instance with base configuration\n// Support both localhost and IP-based access\nconst getBaseURL = () => {\n  if (process.env.REACT_APP_API_URL) {\n    return process.env.REACT_APP_API_URL;\n  }\n  // Auto-detect based on window location\n  const hostname = window.location.hostname;\n  return hostname === 'localhost' ? 'http://localhost:5000' : `http://${hostname}:5000`;\n};\nconst api = axios.create({\n  baseURL: getBaseURL(),\n  timeout: 30000,\n  // 30 seconds\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Request interceptor - Attach token from localStorage\napi.interceptors.request.use(config => {\n  // Skip auth for health checks\n  if (config.url === '/health') {\n    return config;\n  }\n\n  // Get token from localStorage (backend proxy auth)\n  const accessToken = localStorage.getItem('access_token');\n  if (accessToken) {\n    config.headers.Authorization = `Bearer ${accessToken}`;\n    console.log('ðŸ” [API] Token injected from localStorage');\n  } else {\n    console.warn('âš ï¸ [API] No token in localStorage - request may fail');\n  }\n  return config;\n}, error => {\n  console.error('[API] Request error:', error);\n  return Promise.reject(error);\n});\n\n// Response interceptor - Handle errors and token refresh\napi.interceptors.response.use(response => {\n  return response;\n}, async error => {\n  var _error$response, _error$response2, _error$response2$data, _error$response3, _error$response4;\n  const originalRequest = error.config;\n\n  // Handle 401 Unauthorized - Token expired\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    try {\n      const refreshToken = localStorage.getItem('refresh_token');\n      if (!refreshToken) {\n        console.error('[API] No refresh token available');\n        // Redirect to login\n        localStorage.clear();\n        window.location.href = '/';\n        return Promise.reject(error);\n      }\n      console.log('[API] Attempting token refresh...');\n\n      // Call backend refresh endpoint using same baseURL logic\n      const response = await axios.post(`${getBaseURL()}/api/auth/refresh`, {\n        refresh_token: refreshToken\n      });\n      const {\n        access_token,\n        refresh_token: newRefreshToken\n      } = response.data;\n\n      // Update localStorage\n      localStorage.setItem('access_token', access_token);\n      if (newRefreshToken) {\n        localStorage.setItem('refresh_token', newRefreshToken);\n      }\n      console.log('âœ… [API] Token refreshed successfully');\n\n      // Retry original request with new token\n      originalRequest.headers.Authorization = `Bearer ${access_token}`;\n      return api(originalRequest);\n    } catch (refreshError) {\n      console.error('[API] Token refresh failed:', refreshError);\n      // Clear storage and redirect to login\n      localStorage.clear();\n      window.location.href = '/';\n      return Promise.reject(refreshError);\n    }\n  }\n\n  // Handle specific error statuses\n  const errorMessage = ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || error.message;\n  const errorStatus = (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status;\n  console.error(`[API] Error ${errorStatus}:`, errorMessage);\n\n  // Format error for consistent handling\n  const formattedError = {\n    status: errorStatus,\n    message: errorMessage,\n    data: (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.data,\n    originalError: error\n  };\n  return Promise.reject(formattedError);\n});\n\n/**\n * Helper function to handle file downloads\n */\nexport const downloadFile = async (url, filename) => {\n  try {\n    const response = await api.get(url, {\n      responseType: 'blob' // Important for file downloads\n    });\n\n    // Create blob link to download\n    const blob = new Blob([response.data]);\n    const link = document.createElement('a');\n    link.href = window.URL.createObjectURL(blob);\n    link.download = filename || 'download';\n    link.click();\n\n    // Cleanup\n    window.URL.revokeObjectURL(link.href);\n    return {\n      success: true\n    };\n  } catch (error) {\n    console.error('[API] Download error:', error);\n    throw error;\n  }\n};\n\n/**\n * Helper function to upload files with multipart/form-data\n */\nexport const uploadFile = async (url, file, onUploadProgress) => {\n  const formData = new FormData();\n  formData.append('file', file);\n  try {\n    const response = await api.post(url, formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      },\n      onUploadProgress: progressEvent => {\n        if (onUploadProgress) {\n          const percentCompleted = Math.round(progressEvent.loaded * 100 / progressEvent.total);\n          onUploadProgress(percentCompleted);\n        }\n      }\n    });\n    return response.data;\n  } catch (error) {\n    console.error('[API] Upload error:', error);\n    throw error;\n  }\n};\nexport default api;","map":{"version":3,"names":["axios","getBaseURL","process","env","REACT_APP_API_URL","hostname","window","location","api","create","baseURL","timeout","headers","interceptors","request","use","config","url","accessToken","localStorage","getItem","Authorization","console","log","warn","error","Promise","reject","response","_error$response","_error$response2","_error$response2$data","_error$response3","_error$response4","originalRequest","status","_retry","refreshToken","clear","href","post","refresh_token","access_token","newRefreshToken","data","setItem","refreshError","errorMessage","message","errorStatus","formattedError","originalError","downloadFile","filename","get","responseType","blob","Blob","link","document","createElement","URL","createObjectURL","download","click","revokeObjectURL","success","uploadFile","file","onUploadProgress","formData","FormData","append","progressEvent","percentCompleted","Math","round","loaded","total"],"sources":["/Users/mrnugroho/Downloads/pemda-dashboard-react/frontend/src/services/api.js"],"sourcesContent":["/**\n * API Service - Base Axios Configuration\n * Following frontend-developer and react-best-practices patterns\n * Handles Keycloak token injection, error handling, and request/response transformations\n */\n\nimport axios from 'axios';\n\n// Create axios instance with base configuration\n// Create axios instance with base configuration\n// Support both localhost and IP-based access\nconst getBaseURL = () => {\n    if (process.env.REACT_APP_API_URL) {\n        return process.env.REACT_APP_API_URL;\n    }\n    // Auto-detect based on window location\n    const hostname = window.location.hostname;\n    return hostname === 'localhost' ? 'http://localhost:5000' : `http://${hostname}:5000`;\n};\n\nconst api = axios.create({\n    baseURL: getBaseURL(),\n    timeout: 30000, // 30 seconds\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\n// Request interceptor - Attach token from localStorage\napi.interceptors.request.use(\n    (config) => {\n        // Skip auth for health checks\n        if (config.url === '/health') {\n            return config;\n        }\n\n        // Get token from localStorage (backend proxy auth)\n        const accessToken = localStorage.getItem('access_token');\n\n        if (accessToken) {\n            config.headers.Authorization = `Bearer ${accessToken}`;\n            console.log('ðŸ” [API] Token injected from localStorage');\n        } else {\n            console.warn('âš ï¸ [API] No token in localStorage - request may fail');\n        }\n\n        return config;\n    },\n    (error) => {\n        console.error('[API] Request error:', error);\n        return Promise.reject(error);\n    }\n);\n\n// Response interceptor - Handle errors and token refresh\napi.interceptors.response.use(\n    (response) => {\n        return response;\n    },\n    async (error) => {\n        const originalRequest = error.config;\n\n        // Handle 401 Unauthorized - Token expired\n        if (error.response?.status === 401 && !originalRequest._retry) {\n            originalRequest._retry = true;\n\n            try {\n                const refreshToken = localStorage.getItem('refresh_token');\n\n                if (!refreshToken) {\n                    console.error('[API] No refresh token available');\n                    // Redirect to login\n                    localStorage.clear();\n                    window.location.href = '/';\n                    return Promise.reject(error);\n                }\n\n                console.log('[API] Attempting token refresh...');\n\n                // Call backend refresh endpoint using same baseURL logic\n                const response = await axios.post(`${getBaseURL()}/api/auth/refresh`, {\n                    refresh_token: refreshToken\n                });\n\n                const { access_token, refresh_token: newRefreshToken } = response.data;\n\n                // Update localStorage\n                localStorage.setItem('access_token', access_token);\n                if (newRefreshToken) {\n                    localStorage.setItem('refresh_token', newRefreshToken);\n                }\n\n                console.log('âœ… [API] Token refreshed successfully');\n\n                // Retry original request with new token\n                originalRequest.headers.Authorization = `Bearer ${access_token}`;\n                return api(originalRequest);\n\n            } catch (refreshError) {\n                console.error('[API] Token refresh failed:', refreshError);\n                // Clear storage and redirect to login\n                localStorage.clear();\n                window.location.href = '/';\n                return Promise.reject(refreshError);\n            }\n        }\n\n        // Handle specific error statuses\n        const errorMessage = error.response?.data?.message || error.message;\n        const errorStatus = error.response?.status;\n\n        console.error(`[API] Error ${errorStatus}:`, errorMessage);\n\n        // Format error for consistent handling\n        const formattedError = {\n            status: errorStatus,\n            message: errorMessage,\n            data: error.response?.data,\n            originalError: error,\n        };\n\n        return Promise.reject(formattedError);\n    }\n);\n\n/**\n * Helper function to handle file downloads\n */\nexport const downloadFile = async (url, filename) => {\n    try {\n        const response = await api.get(url, {\n            responseType: 'blob', // Important for file downloads\n        });\n\n        // Create blob link to download\n        const blob = new Blob([response.data]);\n        const link = document.createElement('a');\n        link.href = window.URL.createObjectURL(blob);\n        link.download = filename || 'download';\n        link.click();\n\n        // Cleanup\n        window.URL.revokeObjectURL(link.href);\n\n        return { success: true };\n    } catch (error) {\n        console.error('[API] Download error:', error);\n        throw error;\n    }\n};\n\n/**\n * Helper function to upload files with multipart/form-data\n */\nexport const uploadFile = async (url, file, onUploadProgress) => {\n    const formData = new FormData();\n    formData.append('file', file);\n\n    try {\n        const response = await api.post(url, formData, {\n            headers: {\n                'Content-Type': 'multipart/form-data',\n            },\n            onUploadProgress: (progressEvent) => {\n                if (onUploadProgress) {\n                    const percentCompleted = Math.round(\n                        (progressEvent.loaded * 100) / progressEvent.total\n                    );\n                    onUploadProgress(percentCompleted);\n                }\n            },\n        });\n\n        return response.data;\n    } catch (error) {\n        console.error('[API] Upload error:', error);\n        throw error;\n    }\n};\n\nexport default api;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}